<div class="container py-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="display-5 fw-bold text-primary">
        <i class="fas fa-plus me-3" *ngIf="!isEditMode"></i>
        <i class="fas fa-edit me-3" *ngIf="isEditMode"></i>
        {{ isEditMode ? 'Editar' : 'Agregar' }} Dispositivo
      </h1>
      <p class="lead text-muted">
        {{ isEditMode ? 'Modifica la información del dispositivo' : 'Completa la información para agregar un nuevo dispositivo' }}
      </p>
    </div>
  </div>

  <!-- Debug Info -->
  <div class="alert alert-info" role="alert">
    <strong>Debug Info:</strong> 
    <br>Loading: {{ loading }}
    <br>Edit Mode: {{ isEditMode }}
    <br>Submitted: {{ submitted }}
    <br>Device ID: {{ device.id }}
    <br>Error: {{ errorMessage }}
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3">{{ isEditMode ? 'Cargando dispositivo...' : 'Guardando dispositivo...' }}</p>
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>
    <strong>Error:</strong> {{ errorMessage }}
  </div>

  <!-- Formulario -->
  <div *ngIf="!loading" class="row">
    <div class="col-lg-8 mx-auto">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-info-circle me-2"></i>Información del Dispositivo
          </h5>
        </div>
        <div class="card-body">
          <form (ngSubmit)="onSubmit()" #deviceForm="ngForm">
            <div class="row">
              <!-- Nombre -->
              <div class="col-md-6 mb-3">
                <label for="name" class="form-label">Nombre *</label>
                <input type="text" 
                       class="form-control" 
                       id="name"
                       [(ngModel)]="device.name"
                       name="name"
                       [class.is-invalid]="isFieldInvalid('name')"
                       required>
                <div class="invalid-feedback" *ngIf="isFieldInvalid('name')">
                  {{ getFieldError('name') }}
                </div>
              </div>

              <!-- Marca -->
              <div class="col-md-6 mb-3">
                <label for="brand" class="form-label">Marca *</label>
                <input type="text" 
                       class="form-control" 
                       id="brand"
                       [(ngModel)]="device.brand"
                       name="brand"
                       [class.is-invalid]="isFieldInvalid('brand')"
                       required>
                <div class="invalid-feedback" *ngIf="isFieldInvalid('brand')">
                  {{ getFieldError('brand') }}
                </div>
              </div>
            </div>

            <div class="row">
              <!-- Tipo -->
              <div class="col-md-6 mb-3">
                <label for="type" class="form-label">Tipo *</label>
                <select class="form-select" 
                        id="type"
                        [(ngModel)]="device.type"
                        name="type"
                        required>
                  <option *ngFor="let type of deviceTypes" [value]="type">
                    {{ getDeviceTypeLabel(type) }}
                  </option>
                </select>
              </div>

              <!-- Precio -->
              <div class="col-md-6 mb-3">
                <label for="price" class="form-label">Precio *</label>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <input type="number" 
                         class="form-control" 
                         id="price"
                         [(ngModel)]="device.price"
                         name="price"
                         [class.is-invalid]="isFieldInvalid('price')"
                         min="0"
                         step="0.01"
                         required>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('price')">
                    {{ getFieldError('price') }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Descripción -->
            <div class="mb-3">
              <label for="description" class="form-label">Descripción *</label>
              <textarea class="form-control" 
                        id="description"
                        [(ngModel)]="device.description"
                        name="description"
                        [class.is-invalid]="isFieldInvalid('description')"
                        rows="3"
                        required
                        placeholder="Describe las características principales del dispositivo..."></textarea>
              <div class="invalid-feedback" *ngIf="isFieldInvalid('description')">
                {{ getFieldError('description') }}
              </div>
            </div>

            <div class="row">
              <!-- Fecha de lanzamiento -->
              <div class="col-md-6 mb-3">
                <label for="releaseDate" class="form-label">Fecha de Lanzamiento</label>
                <input type="date" 
                       class="form-control" 
                       id="releaseDate"
                       [(ngModel)]="device.releaseDate"
                       name="releaseDate">
              </div>

              <!-- URL de imagen -->
              <div class="col-md-6 mb-3">
                <label for="imageUrl" class="form-label">URL de Imagen</label>
                <input type="url" 
                       class="form-control" 
                       id="imageUrl"
                       [(ngModel)]="device.imageUrl"
                       name="imageUrl"
                       placeholder="https://ejemplo.com/imagen.jpg">
              </div>
            </div>

            <!-- Especificaciones -->
            <div class="mb-3">
              <label for="specifications" class="form-label">Especificaciones</label>
              <textarea class="form-control" 
                        id="specifications"
                        [(ngModel)]="device.specifications"
                        name="specifications"
                        rows="4"
                        placeholder="Lista las especificaciones técnicas del dispositivo..."></textarea>
            </div>

            <!-- Botones -->
            <div class="d-flex justify-content-between">
              <button type="button" 
                      class="btn btn-secondary"
                      (click)="cancel()">
                <i class="fas fa-times me-2"></i>Cancelar
              </button>
              
              <button type="submit" 
                      class="btn btn-primary"
                      [disabled]="loading">
                <i class="fas fa-save me-2" *ngIf="!loading"></i>
                <span class="spinner-border spinner-border-sm me-2" *ngIf="loading"></span>
                {{ isEditMode ? 'Actualizar' : 'Crear' }} Dispositivo
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Vista previa de la imagen -->
  <div *ngIf="device.imageUrl && !loading" class="row mt-4">
    <div class="col-lg-8 mx-auto">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-eye me-2"></i>Vista Previa de la Imagen
          </h5>
        </div>
        <div class="card-body text-center">
          <img [src]="device.imageUrl" 
               [alt]="device.name"
               style="max-width: 100%; max-height: 300px; object-fit: cover; border-radius: 8px;"
               onerror="this.style.display='none'">
          <p *ngIf="!device.imageUrl" class="text-muted mt-2">
            No hay imagen para mostrar
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
